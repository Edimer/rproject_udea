---
title: "Gráficos con ggplot2"
author: "Edimer David Jaramillo"
date: "`r Sys.Date()`"
output: 
  html_document:
    toc: yes
    toc_float: yes
    number_sections: yes
    theme: cerulean
    highlight: pygments
    df_print: paged
    code_folding: show
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE, warning = FALSE, message = FALSE)
```

# Datos iniciales

[Evaluaciones agropecuarias departamento de Boyacá](https://www.datos.gov.co/Agricultura-y-Desarrollo-Rural/Evaluaciones-Agropecuarias-por-consenso-DEPARTAMEN/u958-pr9h)

```{r}
library(tidyverse)
datos_inicial <- read_csv("Evaluaciones_Agropecuarias_por_consenso_DEPARTAMENTO_DE_BOYAC_.csv")
```

# Datos depurados

- Editar los nombres de las variables.
- Unificar los niveles del municipio quitando las tiles a través de la función *stri_trans_general()* del paquete stringi.
- Recodificar la etiqueta de "VILLA DE LEYVA" a "VILLA DE LEIVA". 
- Separar la columna "periodo" en dos nuevas variables con información de año y semestre. Esto lo hacemos porque están en una sola variable.
- Convertir la variable "year" de character a numeric.

```{r}
library(janitor)
library(stringi)
datos_final <- datos_inicial %>% 
  clean_names() %>% 
  mutate(municipio = stri_trans_general(municipio, "Latin-ASCII"),
         municipio = str_replace_all(municipio,
                                     "VILLA DE LEYVA",
                                     "VILLA DE LEIVA")) %>% 
  separate(col = periodo,
           into = c("year", "semestre"),
           sep = 4) %>% 
  mutate(year = as.numeric(year)) 

datos_final
```

# Cantidades

## Conteos barras

- ¿Cuáles son los 10 cultivos con mayor número de registros?

```{r}
datos_final %>% 
  count(cultivo) %>% 
  arrange(desc(n)) %>% 
  slice(1:10) %>% 
  ggplot(mapping = aes(x = cultivo, y = n)) +
  geom_col()
```


# Anexos

- Consultando los niveles de la variable municipio:

```{r}
levels(as.factor(datos_inicial$MUNICIPIO))
```

- Consultando el número de niveles de la variable municipio:

```{r}
length(levels(as.factor(datos_inicial$MUNICIPIO)))
```

